
; Copyright (c) 1998, Written by VALENTIN KOLESNIKOV, Kiev, Ukraine.
; Этот модуль играет мелодии. Почему-то под многозадачками сильно тянет ?
;

public  setMus,resetMus,off1C,beep,beep1,beep2
extrn   varSound:byte
        .model small
        .code
set1C proc
        cmp varSound,0
        je noSet1C
        push ax bx dx ds es
        mov ax,351Ch
        int 21h
        mov off1C,bx
        mov seg1C,es
        mov word ptr pointT,0
        sti
        push cs
        pop  ds
        lea dx,int1C
        mov ah,25h
        int 21h
        pop es ds dx bx ax
noSet1C:
        ret
        endp
setMus proc
        push ax
        lea ax,tableC
        mov cs:adrTab,ax
        call set1C
        pop ax
        ret
        endp
beep2 proc
        push ax bx
        lea bx,table3
        mov ax,2*2      ;31*2
        jmp short goSet1C
        endp
beep1 proc
        push ax bx
        lea bx,tableM
        mov ax,2*2      ;14*2
        jmp short goSet1C
        endp
beep proc
        push ax bx
        lea bx,tableW
        mov ax,2*2      ;18*2
goSet1C:
        cmp varSound,0
        je noSound
        mov cs:adrTab,bx
        pushf
        call set1C
pause:
        sti
        push ax
        mov ah,1
        int 16h
        pop ax
        jnz offSound
        cmp pointT,ax
        jb pause
offSound:
        call resetMus
        popf
noSound:
        pop bx ax
        ret
        endp
resetMus proc
        cmp varSound,0
        je noResMus
        push ax dx ds
        lds dx,dword ptr off1C
        mov ax,251Ch
        int 21h
        in al,61h
        and al,0FCh
        out 61h,al
        pop ds dx ax
noResMus:
        ret
        endp
int1C proc
        cli
        push   ax bx ds
        mov    bx,@data
        mov    ds,bx
        mov    ah,ds:curstop
        cmp    ah,ds:stop
        jl     delay
        push   cx dx
        mov    bx,ds:pointt
adrTab  equ    word ptr $+2
        mov    dx,word ptr ds:[tablec+bx]
        cmp    dx,-1
        je     contPlay
        mov    cl,5
        mov    bx,dx
        shr    bx,cl
        and    dl,3fh
        dec    dl
        mov    ds:stop,dl
        mov    al,0B6h
        out    43h,al
        mov    ax,34ddh
        mov    dx,0012h
        cmp    dx,bx
        jae    soundOFF
        div    bx
        out    42h,al
        mov    al,ah
        out    42h,al
        in     al,61h
        or     al,3
        out    61h,al
        jmp    short soundon
soundOFF:
        in     al,61h
        and    al,0fch
        out    61h,al
soundON:
        mov    ds:curstop,0
        mov    bx,ds:pointt
        inc    bx
        inc    bx
maximNot equ word ptr $+2
        cmp    bx,655*2
        jng    contplay
        xor    bx,bx
contPlay:
        mov    ds:pointt,bx
        pop    dx cx
        jmp    short exitint1c
delay:
        inc    ah
        mov    ds:curstop,ah
exitInt1C:
        pop    ds bx ax
        iret
        endp
        .data
key1            db 0
key2            db 0
pointT          dw 0
stop            db 0
curStop         db 0
tableC  equ $
        dw  1168*32+1 , 0   *32+3 , 1400*32+2 , 1168*32+2 , 880 *32+1
        dw  0   *32+3 , 1168*32+2 , 880 *32+2 , 700 *32+1 , 0   *32+3
        dw  880 *32+2 , 700 *32+2 , 584 *32+7 , 0   *32+1 , 440 *32+2
        dw  584 *32+2 , 700 *32+2 , 584 *32+2 , 660 *32+2 , 584 *32+2
        dw  660 *32+2 , 584 *32+2 , 552 *32+2 , 660 *32+2 , 784 *32+2
        dw  660 *32+2 , 700 *32+1 , 0   *32+3 , 584 *32+1 , 0   *32+3
        dw  1168*32+1 , 0   *32+3 , 1400*32+2 , 1168*32+2 , 880 *32+1
        dw  0   *32+3 , 1168*32+2 , 880 *32+2 , 700 *32+1 , 0   *32+3
        dw  880 *32+2 , 700 *32+2 , 584 *32+7 , 0   *32+1 , 700 *32+1
        dw  0   *32+3 , 700 *32+1 , 0   *32+3 , 700 *32+1 , 0   *32+3
        dw  700 *32+1 , 0   *32+3 , 1168*32+1 , 0   *32+3 , 700 *32+1
        dw  0   *32+3 , 700 *32+1 , 784 *32+1 , 700 *32+1 , 660 *32+1
        dw  660 *32+3 , 0   *32+0 , 880 *32+1 , 0   *32+3 , 880 *32+1
        dw  0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3
        dw  1400*32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1
        dw  988 *32+1 , 880 *32+1 , 832 *32+1 , 832 *32+3 , 0   *32+0
        dw  660 *32+2 , 880 *32+2 , 1048*32+2 , 880 *32+2 , 988 *32+2
        dw  880 *32+2 , 988 *32+2 , 880 *32+2 , 832 *32+2 , 988 *32+2
        dw  1168*32+2 , 988 *32+2 , 1048*32+2 , 988 *32+2 , 1048*32+2
        dw  988 *32+2 , 880 *32+2 , 1048*32+2 , 880 *32+2 , 832 *32+2
        dw  880 *32+2 , 1168*32+2 , 880 *32+2 , 832 *32+2 , 880 *32+2
        dw  1320*32+2 , 880 *32+2 , 832 *32+2 , 880 *32+2 , 1400*32+2
        dw  880 *32+2 , 832 *32+2 , 880 *32+2 , 1400*32+2 , 1320*32+2
        dw  1168*32+2 , 1320*32+2 , 1048*32+2 , 988 *32+2 , 880 *32+2
        dw  1048*32+1 , 0   *32+3 , 988 *32+1 , 880 *32+1 , 988 *32+2
        dw  880 *32+3 , 0   *32+0 , 0   *32+4 , 1168*32+1 , 0   *32+3
        dw  1760*32+1 , 1400*32+1 , 1168*32+1 , 932 *32+1 , 880 *32+1
        dw  0   *32+3 , 1168*32+1 , 1048*32+1 , 880 *32+1 , 784 *32+1
        dw  700 *32+1 , 0   *32+3 , 880 *32+1 , 784 *32+1 , 700 *32+1
        dw  660 *32+1 , 584 *32+7 , 0   *32+1 , 440 *32+2 , 584 *32+2
        dw  700 *32+2 , 584 *32+2 , 660 *32+2 , 584 *32+2 , 660 *32+2
        dw  584 *32+2 , 552 *32+2 , 660 *32+2 , 784 *32+2 , 660 *32+2
        dw  700 *32+1 , 0   *32+3 , 584 *32+1 , 0   *32+3 , 1168*32+1
        dw  0   *32+3 , 1400*32+2 , 1168*32+2 , 880 *32+1 , 0   *32+3
        dw  1168*32+2 , 880 *32+2 , 700 *32+1 , 0   *32+3 , 880 *32+2
        dw  700 *32+2 , 584 *32+7 , 0   *32+1 , 700 *32+1 , 0   *32+3
        dw  700 *32+1 , 0   *32+3 , 700 *32+1 , 0   *32+3 , 700 *32+1
        dw  0   *32+3 , 1168*32+1 , 0   *32+3 , 700 *32+1 , 0   *32+3
        dw  700 *32+1 , 784 *32+1 , 700 *32+1 , 660 *32+1 , 660 *32+3
        dw  0   *32+0 , 880 *32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3
        dw  880 *32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3 , 1400*32+1
        dw  0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1 , 988 *32+1
        dw  880 *32+1 , 832 *32+1 , 832 *32+3 , 0   *32+0 , 660 *32+2
        dw  880 *32+2 , 1048*32+2 , 880 *32+2 , 988 *32+2 , 880 *32+2
        dw  988 *32+2 , 880 *32+2 , 832 *32+2 , 988 *32+2 , 1168*32+2
        dw  988 *32+2 , 1048*32+2 , 988 *32+2 , 1048*32+2 , 988 *32+2
        dw  880 *32+2 , 1048*32+2 , 880 *32+2 , 832 *32+2 , 880 *32+2
        dw  1168*32+2 , 880 *32+2 , 832 *32+2 , 880 *32+2 , 1320*32+2
        dw  880 *32+2 , 832 *32+2 , 880 *32+2 , 1400*32+2 , 880 *32+2
        dw  832 *32+2 , 880 *32+2 , 1400*32+2 , 1320*32+2 , 1168*32+2
        dw  1320*32+2 , 1048*32+2 , 988 *32+2 , 880 *32+2 , 1048*32+1
        dw  0   *32+3 , 988 *32+1 , 880 *32+1 , 988 *32+2 , 880 *32+3
        dw  0   *32+0 , 0   *32+4 , 880 *32+1 , 0   *32+3 , 1048*32+1
        dw  0   *32+0 , 880 *32+1 , 0   *32+0 , 660 *32+1 , 0   *32+3
        dw  880 *32+1 , 0   *32+0 , 660 *32+1 , 0   *32+0 , 524 *32+1
        dw  0   *32+3 , 660 *32+1 , 0   *32+0 , 524 *32+1 , 0   *32+0
        dw  440 *32+7 , 0   *32+1 , 620 *32+4 , 584 *32+3 , 0   *32+0
        dw  784 *32+4 , 740 *32+2 , 880 *32+2 , 1048*32+4 , 932 *32+2
        dw  880 *32+2 , 932 *32+1 , 0   *32+3 , 784 *32+1 , 0   *32+3
        dw  932 *32+1 , 0   *32+3 , 1168*32+1 , 0   *32+0 , 932 *32+1
        dw  0   *32+0 , 784 *32+1 , 0   *32+3 , 932 *32+1 , 0   *32+0
        dw  784 *32+1 , 0   *32+0 , 660 *32+1 , 0   *32+3 , 784 *32+1
        dw  0   *32+0 , 660 *32+1 , 0   *32+0 , 524 *32+7 , 0   *32+1
        dw  524 *32+2 , 700 *32+2 , 880 *32+2 , 700 *32+2 , 784 *32+2
        dw  700 *32+2 , 784 *32+2 , 700 *32+2 , 660 *32+2 , 784 *32+2
        dw  932 *32+2 , 784 *32+2 , 880 *32+2 , 784 *32+2 , 880 *32+2
        dw  784 *32+2 , 700 *32+2 , 880 *32+2 , 700 *32+2 , 660 *32+2
        dw  700 *32+2 , 932 *32+2 , 700 *32+2 , 660 *32+2 , 700 *32+2
        dw  1048*32+2 , 700 *32+2 , 660 *32+2 , 700 *32+2 , 1168*32+2
        dw  700 *32+2 , 660 *32+2 , 700 *32+2 , 1168*32+2 , 1048*32+2
        dw  932 *32+2 , 1048*32+2 , 880 *32+2 , 784 *32+2 , 700 *32+2
        dw  880 *32+1 , 0   *32+3 , 784 *32+1 , 700 *32+1 , 784 *32+1
        dw  0   *32+0 , 700 *32+4 , 0   *32+4 , 880 *32+1 , 0   *32+3
        dw  880 *32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1
        dw  0   *32+3 , 1400*32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3
        dw  880 *32+1 , 932 *32+1 , 880 *32+2 , 784 *32+3 , 0   *32+0
        dw  784 *32+1 , 0   *32+3 , 784 *32+1 , 0   *32+3 , 784 *32+1
        dw  0   *32+3 , 784 *32+1 , 0   *32+3 , 1320*32+1 , 0   *32+3
        dw  784 *32+1 , 0   *32+3 , 784 *32+1 , 880 *32+1 , 784 *32+2
        dw  700 *32+3 , 0   *32+0 , 1168*32+4 , 1400*32+1 , 0   *32+0
        dw  1168*32+1 , 0   *32+0 , 1048*32+1 , 0   *32+0 , 932 *32+6
        dw  932 *32+3 , 0   *32+0 , 1168*32+1 , 1048*32+1 , 932 *32+1
        dw  880 *32+1 , 784 *32+8 , 784 *32+3 , 0   *32+0 , 932 *32+1
        dw  880 *32+1 , 784 *32+1 , 700 *32+1 , 620 *32+2 , 784 *32+2
        dw  932 *32+2 , 784 *32+2 , 620 *32+2 , 584 *32+2 , 620 *32+2
        dw  584 *32+2 , 552 *32+3 , 0   *32+0 , 440 *32+3 , 0   *32+0
        dw  466 *32+3 , 0   *32+0 , 440 *32+3 , 0   *32+0 , 584 *32+4
        dw  552 *32+2 , 660 *32+2 , 784 *32+4 , 700 *32+2 , 660 *32+2
        dw  700 *32+4 , 584 *32+1 , 660 *32+1 , 700 *32+1 , 784 *32+1
        dw  880 *32+4 , 700 *32+2 , 880 *32+2 , 1168*32+4 , 880 *32+4
        dw  784 *32+2 , 700 *32+2 , 660 *32+2 , 700 *32+2 , 660 *32+2
        dw  584 *32+6 , 880 *32+1 , 0   *32+0 , 880 *32+1 , 0   *32+0
        dw  1048*32+1 , 0   *32+0 , 880 *32+1 , 0   *32+0 , 660 *32+1
        dw  0   *32+0 , 660 *32+1 , 0   *32+0 , 880 *32+1 , 0   *32+0
        dw  660 *32+1 , 0   *32+0 , 524 *32+1 , 0   *32+0 , 524 *32+1
        dw  0   *32+0 , 660 *32+1 , 0   *32+0 , 524 *32+1 , 0   *32+0
        dw  440 *32+7 , 0   *32+1 , 620 *32+4 , 584 *32+3 , 0   *32+0
        dw  784 *32+4 , 740 *32+2 , 880 *32+2 , 1048*32+4 , 932 *32+2
        dw  880 *32+2 , 932 *32+1 , 0   *32+3 , 784 *32+1 , 0   *32+3
        dw  932 *32+1 , 1048*32+1 , 1168*32+1 , 1048*32+1 , 932 *32+1
        dw  880 *32+1 , 784 *32+1 , 880 *32+1 , 932 *32+1 , 880 *32+1
        dw  784 *32+1 , 700 *32+1 , 660 *32+1 , 700 *32+1 , 784 *32+1
        dw  700 *32+1 , 660 *32+1 , 584 *32+1 , 524 *32+8 , 524 *32+2
        dw  700 *32+2 , 880 *32+2 , 700 *32+2 , 784 *32+2 , 700 *32+2
        dw  784 *32+2 , 700 *32+2 , 660 *32+2 , 784 *32+2 , 932 *32+2
        dw  784 *32+2 , 880 *32+2 , 784 *32+2 , 880 *32+2 , 784 *32+2
        dw  700 *32+2 , 880 *32+2 , 700 *32+2 , 660 *32+2 , 700 *32+2
        dw  932 *32+2 , 700 *32+2 , 660 *32+2 , 700 *32+2 , 1048*32+2
        dw  700 *32+2 , 660 *32+2 , 700 *32+2 , 1168*32+2 , 700 *32+2
        dw  660 *32+2 , 700 *32+2 , 1168*32+2 , 1048*32+2 , 932 *32+2
        dw  1048*32+2 , 880 *32+2 , 784 *32+2 , 700 *32+2 , 880 *32+1
        dw  0   *32+3 , 784 *32+1 , 880 *32+1 , 784 *32+1 , 0   *32+0
        dw  700 *32+4 , 0   *32+4 , 880 *32+1 , 0   *32+3 , 880 *32+1
        dw  0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3
        dw  1400*32+1 , 0   *32+3 , 880 *32+1 , 0   *32+3 , 880 *32+1
        dw  932 *32+1 , 880 *32+2 , 784 *32+3 , 0   *32+0 , 784 *32+1
        dw  0   *32+3 , 784 *32+1 , 0   *32+3 , 784 *32+1 , 0   *32+3
        dw  784 *32+1 , 0   *32+3 , 1320*32+1 , 0   *32+3 , 784 *32+1
        dw  0   *32+3 , 784 *32+1 , 880 *32+1 , 784 *32+2 , 700 *32+3
        dw  0   *32+0 , 1168*32+4 , 1400*32+1 , 0   *32+0 , 1168*32+1
        dw  0   *32+0 , 1048*32+1 , 0   *32+0 , 932 *32+6 , 932 *32+3
        dw  0   *32+0 , 1168*32+1 , 1048*32+1 , 932 *32+1 , 880 *32+1
        dw  784 *32+8 , 784 *32+3 , 0   *32+0 , 932 *32+1 , 880 *32+1
        dw  784 *32+1 , 700 *32+1 , 620 *32+2 , 784 *32+2 , 932 *32+2
        dw  784 *32+2 , 620 *32+2 , 584 *32+2 , 620 *32+2 , 584 *32+2
        dw  552 *32+3 , 0   *32+0 , 440 *32+3 , 0   *32+0 , 466 *32+4
        dw  0   *32+0 , 440 *32+4 , 0   *32+0 , 584 *32+4 , 552 *32+2
        dw  660 *32+2 , 784 *32+4 , 700 *32+2 , 660 *32+2 , 700 *32+4
        dw  584 *32+1 , 660 *32+1 , 700 *32+1 , 784 *32+1 , 880 *32+5
        dw  700 *32+2 , 880 *32+2 , 1168*32+5 , 880 *32+5 , 784 *32+3
        dw  700 *32+3 , 660 *32+3 , 700 *32+3 , 660 *32+3 , 584 *32+11
        dw  584 *32+15
tableW  dw  660 *32+1 , 584 *32+1 ,-1
tableM  dw   524 *32+0 ,  0   *32+2 ,-1
table3  dw  584 *32+1 , 660 *32+1 , -1
off1C   dw ?
seg1C   dw ?
        end
